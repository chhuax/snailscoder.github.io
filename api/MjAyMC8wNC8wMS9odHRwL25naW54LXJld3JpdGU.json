{"title":"个人博客Nginx强制跳转Https配置","date":"2020-04-01T19:38:25.000Z","date_formatted":{"ll":"2020年4月1日","L":"2020/04/01","MM-DD":"04-01"},"thumbnail":"https://blogimg-1254014761.cos.ap-beijing.myqcloud.com/2020/04/01/img1276.png","link":"2020/04/01/http/nginx-rewrite","comments":true,"tags":["Http","Nginx","Ssl"],"categories":["后端"],"updated":"2020-04-01T12:25:46.588Z","content":"<p>今日因需要将自己的博客域名加入https支持，并把之前的HTTP访问强制跳转到HTTPS。</p>\n<h2 id=\"1、nginx支持https\">1、nginx支持https<a href=\"#1、nginx支持https\" title=\"1、nginx支持https\"></a></h2><p>如果起初nginx编译时没有添加ssl支持，需要对nginx重新编译，增加http_ssl_module模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.配置</span><br><span class=\"line\">.&#x2F;configure </span><br><span class=\"line\">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx </span><br><span class=\"line\">--with-http_stub_status_module </span><br><span class=\"line\">--with-http_ssl_module</span><br><span class=\"line\">2.编译安装</span><br><span class=\"line\">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h2 id=\"2、配置https域及ssl证书\">2、配置https域及SSL证书<a href=\"#2、配置https域及ssl证书\" title=\"2、配置https域及SSL证书\"></a></h2><p>没有证书的可以考虑腾讯云申请免费证书，但仅限单域名,申请地址:<a href=\"https://cloud.tencent.com/product/ssl\" target=\"_blank\">https://cloud.tencent.com/product/ssl</a>,<br>申请通过后，下载nginx专用证书。<br>以下为https证书相关配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       443 ssl;</span><br><span class=\"line\">    server_name  www.snailscoder.com;</span><br><span class=\"line\">    ssl_certificate      ..&#x2F;ssl&#x2F;***.crt;</span><br><span class=\"line\">    ssl_certificate_key  ..&#x2F;ssl&#x2F;***.key;</span><br><span class=\"line\">    ssl_session_cache    shared:SSL:1m;</span><br><span class=\"line\">    ssl_session_timeout  5m;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        root   html;</span><br><span class=\"line\">        index  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>配置好后，测试https是否可以正常访问。</p>\n<h2 id=\"3、http强制跳转https\">3、http强制跳转https<a href=\"#3、http强制跳转https\" title=\"3、http强制跳转https\"></a></h2><p>此处因http下无其他信息，单纯配置了跳转</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       80;</span><br><span class=\"line\">    server_name  www.snailscoder.com;</span><br><span class=\"line\">    #方式一</span><br><span class=\"line\">    return      301 https:&#x2F;&#x2F;$server_name$request_uri;</span><br><span class=\"line\">    #方式二</span><br><span class=\"line\">    #rewrite ^&#x2F;(.*)$ https:&#x2F;&#x2F;www.snailscoder.com&#x2F;$1 permanent;</span><br><span class=\"line\">    #方式三</span><br><span class=\"line\">    #rewrite ^ https:&#x2F;&#x2F;www.snailscoder.com$request_uri? permanent;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>博客内容较简单，仅为个人配置记录，有问题可留言咨询。有更好的方案，也请多多指教。</p>\n","prev":{"title":"东小口森林公园-花朵","link":"2020/04/02/travel/dxk"},"next":{"title":"Java虚拟机总结思维导图","link":"2020/04/01/java/100001"},"plink":"https://snailscoder.com/2020/04/01/http/nginx-rewrite/","reward":true,"copyright":{"link":"<a href=\"https://snailscoder.com/2020/04/01/http/nginx-rewrite/\" title=\"个人博客Nginx强制跳转Https配置\">https://snailscoder.com/2020/04/01/http/nginx-rewrite/</a>","license":"自由转载-非商用-禁止演绎-保持署名(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}